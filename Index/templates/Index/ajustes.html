{% extends 'layout/layout.html' %}
{% load static %}
{% block body %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/classic.min.css" />
<script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.es5.min.js"></script>

<style>
    /* 1. Selector más específico para anular las propiedades originales de Pickr */
    .pickr .pcr-button {
        height: 2.5em;
        /* Nuevo valor */
        width: 2.5em;
        /* Nuevo valor */
        margin-top: 0.5em;
        /*border-radius: 50%;
*/

    }

    /* 2. Mantener tus estilos adicionales (como el borde que añadiste) */
    .pcr-button {
        border: 4px solid var(--bs-primary, #0d6efd) !important;
        border-radius: 50%;
        /* Eliminamos height: 38px; para dejar que 3em tome control */
    }

    /* Estilo para hacer el checkbox más grande */
    .form-check-input.form-check-lg {
        height: 2.5em;
        width: 2.5em;
        margin-top: 0.25em;
    }
</style>

<div class="container my-4">
    <h1 class="fnSuperiorRegularTitle2 text-secondary "> Modificar estados</h1>

    <form method="post">
        <input type="hidden" name="form_name" value="estado_form"> {{ formset.management_form }}
        {% csrf_token %}


        <div class="row mb-3">

            {% if formset.non_field_errors %}
            <div class="alert alert-danger w-100">
                {% for error in formset.non_field_errors %}{{ error }}{% endfor %}
            </div>
            {% endif %}

            {# Encabezados de Columna #}
            <div class="col-md-8 col-2 fnSuperiorRegularTitle3 d-none d-md-block"><label>Nombre</label></div>
            <div class="col-md-2 col-2 fnSuperiorRegularTitle3 d-none d-md-block"><label>Color</label></div>
            <div class="col-md-2 col-2 fnSuperiorRegularTitle3 d-none d-md-block"><label>Picker</label></div>
            <!--             <div class="col-1 fnSuperiorRegularTitle3"><label>Eliminar</label></div>
 -->
            <div class="col-6"></div> {# Espacio libre restante #}

            {% for form in formset %}

            {# Columna 1: Nombre (3 cols) #}
            <div class="col-md-7 col-12 text-center">
                {{ form.nombre }}
                {% if form.nombre.errors %}<div class="text-danger small">{{ form.nombre.errors }}</div>{% endif %}
            </div>

            {# Columna 2 y 3: Color y Picker (3 cols + 2 cols) #}
            <div class="col-md-3 col-10 text-center">
                <div class="d-flex align-items-center">
                    {{ form.color }}
                    {% if form.color.errors %}<div class="text-danger small">{{ form.color.errors }}</div>{% endif %}
                </div>
            </div>

            <div class="col-md-2 col-2 text-center">
                <div class="color-picker-anchor " data-input-id="{{ form.color.id_for_label }}"></div>
            </div>

            {# Columna 4: Eliminar (1 col) #}
            <!--        <div class="col-1 d-flex align-items-center justify-content-center ">
                <div class="form-check">
                    <input type="checkbox" name="{{ form.DELETE.html_name }}" id="{{ form.DELETE.id_for_label }}"
                        class="form-check-input form-check-lg">
                </div>
            </div> -->

            {{ form.id }}

            {% endfor %}
        </div>
        <button type="submit" class="btn btn-primary col-12">Guardar Estados</button>
    </form>
</div>

<div class="container my-4">
    <h1 class="fnSuperiorRegularTitle2 text-secondary "> Modificar Socio</h1>

    <form method="post" id="form-editar-socio">
        {% csrf_token %}
        <input type="hidden" name="form_name" value="socio_form"> <input type="hidden" name="socio_id"
            id="socio-id-input" value="">

        <div class="mb-3">
            <label class="fnSuperiorRegularTitle3" for="{{ formSocios.socio_selector.id_for_label }}">Socio a
                Editar</label>
            {{ formSocios.socio_selector }}
        </div>

        <div class="mb-3">
            <label class="fnSuperiorRegularTitle3" for="{{ formSocios.nombre.id_for_label }}">Nombre</label>
            {{ formSocios.nombre }}
            {% if formSocios.nombre.errors %}<div class="text-danger small">{{ formSocios.nombre.errors }}</div>
            {% endif %}
        </div>

        <div class="mb-3">
            <label class="fnSuperiorRegularTitle3" for="{{ formSocios.tipoPersona.id_for_label }}">Tipo de
                Persona</label>
            {{ formSocios.tipoPersona }}
            {% if formSocios.tipoPersona.errors %}<div class="text-danger small">{{ formSocios.tipoPersona.errors }}
            </div>{% endif %}
        </div>

        <button type="submit" class="btn btn-primary col-12">Guardar Socio</button>
    </form>
</div>

<script>
    function cargarSocio(socioId) {
        const nombreInput = document.getElementById('{{ formSocios.nombre.id_for_label }}');
        const tipoPersonaSelect = document.getElementById('{{ formSocios.tipoPersona.id_for_label }}');
        const socioIdInput = document.getElementById('socio-id-input');

        socioIdInput.value = socioId;

        if (!socioId) {
            nombreInput.value = '';
            tipoPersonaSelect.value = '';
            return;
        }

        fetch(`/obtener-socio-data/${socioId}/`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('No se pudo obtener el socio');
                }
                return response.json();
            })
            .then(data => {
                nombreInput.value = data.nombre;
                tipoPersonaSelect.value = data.tipoPersona;
            })
            .catch(error => console.error('Error al cargar datos del socio:', error));
    }
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const anchors = document.querySelectorAll('.color-picker-anchor');

        anchors.forEach(anchor => {
            const inputId = anchor.dataset.inputId;
            const inputField = document.getElementById(inputId);

            const picker = Pickr.create({
                el: anchor,
                theme: 'classic',
                default: inputField.value || '#000000',
                components: {
                    preview: true,
                    hue: true,
                    interaction: {
                        hex: true,
                        input: true,
                        clear: false,
                        save: true
                    }
                }
            });

            inputField.classList.add('border', 'border-3', 'border-primary', 'my-2', 'rounded', 'rounded-5');
            inputField.style.backgroundColor = inputField.value;
            //inputField.style.borderRadius = 50

            picker.on('change', (color) => {
                const hexColor = color.toHEXA().toString();
                inputField.value = hexColor;
                inputField.style.backgroundColor = hexColor;
            }).on('save', (color) => {
                const hexColor = color.toHEXA().toString();
                inputField.value = hexColor;
                inputField.style.backgroundColor = hexColor;
                picker.hide();
            });
        });
    });
</script>

{% endblock %}