{% extends 'layout/layout.html' %}
{% load static %}
{% block body %}


<div class="container py-4">
    <h4 class="mb-3">Expediente #{{ expediente.pk }}</h4>

    <form method="post" novalidate>
        {% csrf_token %}

        <ul class="nav nav-tabs mb-3" id="seccionTabs" role="tablist">
            {% for item in secciones %}
            <li class="nav-item" role="presentation">
                <button class="nav-link {% if forloop.first %}active{% endif %}" id="tab-{{ item.seccion.pk }}"
                    data-bs-toggle="tab" data-bs-target="#seccion-{{ item.seccion.pk }}" type="button" role="tab">
                    {{ item.seccion.tituloSeccion }} ({{ item.seccion.tipoDeSeccion }})
                </button>
            </li>
            {% endfor %}
        </ul>

        <div class="tab-content">
            {% for item in secciones %}
            <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="seccion-{{ item.seccion.pk }}"
                role="tabpanel">
                <div class="card mb-3">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-sm table-striped mb-0">
                                <thead class="table-secondary">
                                    <tr>
                                        <th style="min-width:160px">Clave</th>
                                        <th>Descripción</th>
                                        <th style="min-width:140px">Fecha</th>
                                        <th style="min-width:140px">Estatus</th>
                                        <th>Comentario</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for fila in item.filas %}
                                    {% with apartado=fila.apartado registro=fila.registro %}
                                    <tr>
                                        <td class="align-middle">{{ apartado.clave }}</td>
                                        <td class="align-middle">{{ apartado.descripcion|linebreaksbr }}</td>
                                        <td>
                                            <input class="form-control form-control-sm" type="date"
                                                name="registro-{{ item.seccion.pk }}-{{ apartado.pk }}-fecha"
                                                value="{{ registro.fecha|default_if_none:'' }}">
                                        </td>
                                        <td>
                                            <select class="form-select form-select-sm"
                                                name="registro-{{ item.seccion.pk }}-{{ apartado.pk }}-estatus">
                                                <option value="" {% if not registro or registro.estatus=='' %}selected{%
                                                    endif %}>--</option>
                                                <option value="ok" {% if registro and registro.estatus=='ok'
                                                    %}selected{% endif %}>ok</option>
                                                <option value="pendiente" {% if registro and
                                                    registro.estatus=='pendiente' %}selected{% endif %}>pendiente
                                                </option>
                                                <option value="rechazado" {% if registro and
                                                    registro.estatus=='rechazado' %}selected{% endif %}>rechazado
                                                </option>
                                            </select>
                                        </td>
                                        <td>
                                            <input class="form-control form-control-sm" type="text"
                                                name="registro-{{ item.seccion.pk }}-{{ apartado.pk }}-comentario"
                                                value="{{ registro.comentario|default_if_none:'' }}">
                                        </td>
                                    </tr>
                                    {% endwith %}
                                    {% empty %}
                                    <tr>
                                        <td colspan="5" class="text-center py-3">No hay apartados definidos para esta
                                            sección.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="d-flex justify-content-end">
            <button class="btn btn-primary" type="submit">Guardar</button>
        </div>
    </form>
</div>



{% endblock %}